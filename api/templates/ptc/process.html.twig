{% extends "content.html.twig" %}

{% block content %}
<section class="row">
    <div class="col-md-12">
        <div class="content">

            <header class="content__header">
                <a class="backlink" href="{{ path('app_ptc_index') }}">{{ 'processes'|trans|capitalize }}</a>
                <header class="content__header">
                    <h1 class="content__header-title">{{ process.name|capitalize }}</h1>
                </header>
            </header>
        </div><!-- ./content -->
    </div><!-- ./col -->
</section>

    {% if not app.user %}
        <div class="notification notification--info">
            <div class="notification__content">
                <div class="notification__type">{{ 'attention'|trans|capitalize }}</div>
                <h2 class="notification__title">{{ 'you can not save or submit procceses if you are not loged in'|trans|capitalize }}</h2>
            </div>
        </div>
    {% endif %}


    {% if request.status == 'in-progress'%}
        <div class="notification notification--info">
            <div class="notification__content">
                <div class="notification__type">{{ 'attention'|trans|capitalize }}</div>
                <h2 class="notification__title">{{ 'this request is in progress and can no longer be altered'|trans|capitalize }}</h2>
            </div>
        </div>
    {% elseif request.status == 'processed '%}
        <div class="notification notification--info">
            <div class="notification__content">
                <div class="notification__type">{{ 'attention'|trans|capitalize }}</div>
                <h2 class="notification__title">{{ 'this request has been procceced and can no longer be altered'|trans|capitalize }}</h2>
            </div>
        </div>
    {%  endif %}

<div class="row">
    <div class="col-md-8  col-sm-12">
        {% if stage.next.slug is defined %}
        <form method="post" action="{{ path('app_ptc_process_stage',{id:process.id, stage:stage.next.slug}) }}" class="form">
        {% else %}
        <form method="post" action="{{ path('app_ptc_process',{id:process.id}) }}" class="form">
        {% endif%}
            {% include 'ptc/widgets/default.html.twig' %}

            {# lets se whats the current request status #}
            {% if submit != 'true' and (request.status is not defined or request.status is empty or request.status)%}

                {% if slug is not defined or slug == false or request.currentStage is not defined or request.currentStage is empty%}
                    {% include 'ptc/widgets/instruction.html.twig' %}
                    {% include 'ptc/widgets/documents.html.twig' %}
                {% else %}
                    {% include 'ptc/widgets/form.html.twig' %}
                {% endif %}

            {% elseif request.status == 'complete' or submit == 'true' %}
                {% include 'ptc/widgets/submit.html.twig' %}
            {% elseif request.status == 'submitted' %}
                {% include 'ptc/widgets/submitted.html.twig' %}
            {% elseif request.status == 'in-progress'%}
                {% include 'ptc/widgets/in-progress.html.twig' %}
            {% elseif request.status == 'processed '%}
                {% include 'ptc/widgets/processed.html.twig' %}
            {% else %}
                {{ 'unknow process status'|trans|capitalize }}
            {% endif %}

            <!-- Page Break -->
            <div style="height: 20px;"></div>

            {% if submit != 'true' and (request.status is not defined or request.status is empty or request.status == 'incomplete')%}
                {% if request.currentStage is not defined or request.currentStage is empty%}
                    {% if not app.user %}
                        <a class="btn btn--block" href="{{ path('app_user_login') }}">{{ 'login'|trans|capitalize }}</a>
                        <!-- Page Break -->
                        {% if process.requireLogin is defined and process.requireLogin != 'true' %}
                        <div style="height: 20px;"></div>
                        <button class="btn btn--block" name="submit">{{ 'continue without logging in'|trans|capitalize }}</button>
                        {% endif %}
                    {% else %}
                        {% if not app.user %}
                        <button class="btn btn--block" name="submit">{{ 'next'|trans|capitalize }}</button>
                        {% else %}
                        <button class="btn btn--block" name="submit">{{ 'start'|trans|capitalize }}</button>
                        {% endif %}
                    {% endif %}
                {% elseif slug is not defined or slug == false %}
                    <div class="col-md-6" style="padding-left: 0px;">
                        <button class="btn btn--block" name="submit">{{ 'continue'|trans|capitalize }}</button>
                    </div>
                {% else %}
                <div class="col-md-6" style="padding-left: 0px;">
                    <button class="btn btn--block" name="submit">{{ 'save'|trans|capitalize }}</button>
                </div>
                {% endif %}
            {% elseif request.status == 'submitted' %}
                <button class="btn btn--block" name="submit">{{ 'retract'|trans|capitalize }}</button>
            {% endif %}

            {% if stage.previous is defined and stage.previous is not null and stage.previous != false %}
                <div class="col-md-6" style="padding-right: 0px;">
                    <a class="btn btn--primary btn--block"
                       href="{{ path('app_ptc_process_stage',{id: process.id, stage: stage.previous.slug}) }}">{{ 'previous'|trans|capitalize }}</a>
                </div>
            {% endif %}
        </form>
    </div><!-- /.col -->

    <div class="col-md-4  col-sm-12">
        {% if request.currentStage is not defined or request.currentStage is empty%}
            {% include 'ptc/widgets/instruction.html.twig' %}
            {% include 'ptc/widgets/documents.html.twig' %}
        {% else %}
            {% include 'ptc/widgets/progressbar.html.twig' %}

            <!-- Page Break -->
            <div style="height: 20px"></div>
            {% include 'ptc/widgets/stages.html.twig' %}

            <!-- Page Break -->
            <div style="height: 20px"></div>
            {% include 'ptc/widgets/checklist.html.twig' %}

            <!-- Page Break -->
            <div style="height: 20px"></div>
            {% include 'ptc/widgets/properties.html.twig' %}

            <!-- Page Break -->
            <div style="height: 20px"></div>
            {% include 'ptc/widgets/contact.html.twig' %}
        {% endif %}
    </div>
</div>
{% endblock %}
